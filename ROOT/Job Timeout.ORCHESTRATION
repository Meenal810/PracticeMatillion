{"job":{"components":{"2210":{"id":2210,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-16,"y":-208,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2221],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Start","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2211":{"id":2211,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":96,"y":-208,"width":32,"height":32,"inputConnectorIDs":[2221],"outputSuccessConnectorIDs":[2217],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Generate the import statement"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import pathlib\nfrom os import path\n\nmypath = pathlib.Path(path.expanduser(\"~\") + \"/\" + prvt_module_path).absolute()\ncontext.updateVariable('prvt_import_statement', 'import sys;sys.path.insert(0, \"{}\")'.format(mypath))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2212":{"id":2212,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-30576485,"x":352,"y":-128,"width":32,"height":32,"inputConnectorIDs":[2223],"outputSuccessConnectorIDs":[2219],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Ensure the Python libraries are available"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"# Ensure that requests is available\ncd\n\nmkdir -p \"$prvt_module_path\" || echo \"$prvt_module_path exists\"\n\n$prvt_python_bin -m pip install --target=\"$HOME/$prvt_module_path\" --ignore-installed requests\n\necho \"Installed prerequisites\"\n"}}}},"visible":true},"3":{"slot":3,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"4":{"slot":4,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2213":{"id":2213,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":224,"y":-208,"width":32,"height":32,"inputConnectorIDs":[2217],"outputSuccessConnectorIDs":[2218],"outputFailureConnectorIDs":[2223],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Verify libraries"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${prvt_import_statement}\n\nimport requests \nimport time\nimport json\nimport math\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2214":{"id":2214,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":464,"y":-208,"width":32,"height":32,"inputConnectorIDs":[2218,2219],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[2222],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2215":{"id":2215,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":592,"y":-208,"width":32,"height":32,"inputConnectorIDs":[2222],"outputSuccessConnectorIDs":[2220],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Reenerate the import statement"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import pathlib\nfrom os import path\n\nmypath = pathlib.Path(path.expanduser(\"~\") + \"/\" + prvt_module_path).absolute()\ncontext.updateVariable('prvt_import_statement', 'import sys;sys.path.insert(0, \"{}\")'.format(mypath))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"2216":{"id":2216,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186829,"x":720,"y":-208,"width":32,"height":32,"inputConnectorIDs":[2220],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Timeout Loop"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${prvt_import_statement}\n\nimport requests \nimport time\nimport json\nimport math\n\n# cancel api call\ncancel_url=\"http://127.0.0.1:8080/rest/v1/group/name/\" + project_group_name + \"/project/name/\" + project_name + \"/task/id/\" + str(run_history_id) + \"/cancel\"\n\n# get task api call\ncheck_url =\"http://127.0.0.1:8080/rest/v1/task/instance?taskID=\" + str(run_history_id)\n\n# Find the number of 5 second intervals to loop before timing out\ntwelve=float(12)\nloop_number=math.trunc(float(str(jv_timeout_minutes))*twelve)\n\n# initialize run_count\nrun_count=0\n# Loop until timeout or until this task is the only one running\nfor x in range(loop_number):\n  \t# make a call to get running tasks\n\tresp = requests.get(check_url, auth=(jv_api_username, jv_api_password))\n    # load response\n\tdictionary=json.loads(resp.text)\n    # reset count of running processes\n\trun_count=0\n    # Nested jobs will have running tasks we are not concerned with, so look for parentID > 0 when counting\n\tfor test in dictionary[\"tasks\"]:\n\t\tif( test[\"parentID\"] > 0 and test[\"state\"] == \"RUNNING\" ) :\n\t\t\trun_count+=1\n    # If there are other tasks running, sleep and check again\n\tif ( run_count > 1 ):\n\t\ttime.sleep(5)\n\telse :\n\t\tbreak\n\n# if we have exhausted the timer and still have\n# other tasks running cancel this task\nif ( run_count > 1 ):\n\tprint(\"Job timeout\")\n\tresp = requests.post(cancel_url, data={}, auth=(jv_api_username, jv_api_password))\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 3"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true},"5":{"slot":5,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Restricted"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"2217":{"id":2217,"sourceID":2211,"targetID":2213},"2218":{"id":2218,"sourceID":2213,"targetID":2214},"2219":{"id":2219,"sourceID":2212,"targetID":2214},"2220":{"id":2220,"sourceID":2215,"targetID":2216}},"failureConnectors":{"2223":{"id":2223,"sourceID":2213,"targetID":2212}},"unconditionalConnectors":{"2221":{"id":2221,"sourceID":2210,"targetID":2211},"2222":{"id":2222,"sourceID":2214,"targetID":2215}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"notes":{},"variables":{"jv_api_password":{"definition":{"name":"jv_api_password","type":"TEXT","scope":"TASKBATCH","description":"That user’s password","visibility":"PUBLIC"},"value":null},"jv_api_username":{"definition":{"name":"jv_api_username","type":"TEXT","scope":"TASKBATCH","description":"A user that has permission to use the API","visibility":"PUBLIC"},"value":null},"jv_timeout_minutes":{"definition":{"name":"jv_timeout_minutes","type":"TEXT","scope":"TASKBATCH","description":"Number of minutes the job is allowed to run before cancelling","visibility":"PUBLIC"},"value":"2"},"prvt_import_statement":{"definition":{"name":"prvt_import_statement","type":"TEXT","scope":"TASKBATCH","description":"The search path statement","visibility":"PRIVATE"},"value":"import sys;"},"prvt_module_path":{"definition":{"name":"prvt_module_path","type":"TEXT","scope":"TASKBATCH","description":"Subdirectory where Python modules will be installed","visibility":"PRIVATE"},"value":"pip3_ensure/python3requests"},"prvt_python_bin":{"definition":{"name":"prvt_python_bin","type":"TEXT","scope":"TASKBATCH","description":"Path to the Python executable","visibility":"PRIVATE"},"value":"/usr/bin/python3"}},"grids":{}},"info":{"name":"Job Timeout","description":"Unpacked from Shared Job [Job Timeout].","type":"ORCHESTRATION","tag":"1357bf44-23a1-41c7-9c61-d0bb31a06636"}}