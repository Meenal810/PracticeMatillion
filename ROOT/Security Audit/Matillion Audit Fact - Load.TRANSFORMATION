{"job":{"components":{"6101":{"id":6101,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-256,"y":0,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6109],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_mtln_api_audit"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg_mtln_api_audit"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"commandType"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"specifier"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"timestamp"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"user"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6102":{"id":6102,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":80,"y":0,"width":32,"height":32,"inputConnectorIDs":[6110],"outputConnectorIDs":[6108],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Shape Data"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATEADD(MS, \"timestamp\", '1970-01-01')"},"2":{"slot":2,"type":"STRING","value":"audit_ts"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SHA2(\"specifier\",256)"},"2":{"slot":2,"type":"STRING","value":"specifier_sh"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"SHA2(\"commandType\",256)"},"2":{"slot":2,"type":"STRING","value":"command_type_sh"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"TO_TIMESTAMP_NTZ( '${curr_ts}' )"},"2":{"slot":2,"type":"STRING","value":"create_ts"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"TO_VARCHAR(DATEADD(MS, \"timestamp\", '1970-01-01'), 'YYYYMMDD')\n"},"2":{"slot":2,"type":"STRING","value":"audit_dtint"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"\"timestamp\""},"2":{"slot":2,"type":"STRING","value":"audit_tsepoch"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6103":{"id":6103,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-80,"y":0,"width":32,"height":32,"inputConnectorIDs":[6109],"outputConnectorIDs":[6110],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter - High Water Mark"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"timestamp"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"${max_audit_ts}"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6104":{"id":6104,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":400,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[6112],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_internal_user_dm"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_internal_user_dm"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"user_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"name"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"start_ts"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"end_ts"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6105":{"id":6105,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":400,"y":0,"width":32,"height":32,"inputConnectorIDs":[6108,6112],"outputConnectorIDs":[6113],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join 0"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Shape Data"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_internal_user_dm"},"2":{"slot":2,"type":"STRING","value":"u"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"stg\".\"user\" = \"u\".\"name\" AND\n\"u\".\"start_ts\" < \"stg\".\"audit_ts\" AND\n\"u\".\"end_ts\" > \"stg\".\"audit_ts\""},"2":{"slot":2,"type":"STRING","value":"stg_Left_u"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"u.user_id"},"2":{"slot":2,"type":"STRING","value":"user_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"stg.id"},"2":{"slot":2,"type":"STRING","value":"audit_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"stg.specifier_sh"},"2":{"slot":2,"type":"STRING","value":"specifier_sh"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"stg.command_type_sh"},"2":{"slot":2,"type":"STRING","value":"command_type_sh"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"stg.audit_tsepoch"},"2":{"slot":2,"type":"STRING","value":"audit_tsepoch"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"stg.audit_dtint"},"2":{"slot":2,"type":"STRING","value":"audit_dtint"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"stg.audit_ts"},"2":{"slot":2,"type":"STRING","value":"audit_ts"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"stg.create_ts"},"2":{"slot":2,"type":"STRING","value":"create_ts"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6106":{"id":6106,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":672,"y":0,"width":32,"height":32,"inputConnectorIDs":[6113],"outputConnectorIDs":[6111],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Swap Defaults"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"COALESCE(\"user_id\", -1)"},"2":{"slot":2,"type":"STRING","value":"user_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"6107":{"id":6107,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":876,"y":-4,"width":32,"height":32,"inputConnectorIDs":[6111],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_audit_log_fct 0"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"mtln_audit_log_fct"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"audit_id"},"2":{"slot":2,"type":"STRING","value":"audit_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"user_id"},"2":{"slot":2,"type":"STRING","value":"user_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"command_type_sh"},"2":{"slot":2,"type":"STRING","value":"command_type_sh"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"specifier_sh"},"2":{"slot":2,"type":"STRING","value":"specifier_sh"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"audit_dtint"},"2":{"slot":2,"type":"STRING","value":"audit_dtint"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"audit_tsepoch"},"2":{"slot":2,"type":"STRING","value":"audit_tsepoch"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"audit_ts"},"2":{"slot":2,"type":"STRING","value":"audit_ts"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"create_ts"},"2":{"slot":2,"type":"STRING","value":"create_ts"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Append"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"[Environment Default]"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"6108":{"id":6108,"sourceID":6102,"targetID":6105},"6109":{"id":6109,"sourceID":6101,"targetID":6103},"6110":{"id":6110,"sourceID":6103,"targetID":6102},"6111":{"id":6111,"sourceID":6106,"targetID":6107},"6112":{"id":6112,"sourceID":6104,"targetID":6105},"6113":{"id":6113,"sourceID":6105,"targetID":6106}},"notes":{"6147":{"id":6147,"x":-152,"y":-110,"width":132,"height":170,"text":"Filter staged data less than High Water Mark (Audit Event Timestamp)","colour":"e6e63c"},"6148":{"id":6148,"x":312,"y":-130,"width":202,"height":348,"text":"User Dimension Lookup - SCD Type 2\nFind the User Dimension row that was Active for the User associated to the Audit Log event when the event occurred.","colour":"e6e63c"},"6149":{"id":6149,"x":566,"y":-132,"width":205,"height":187,"text":"Swap in Default values for any failed Dimension lookups.","colour":"e6e63c"},"6150":{"id":6150,"x":20,"y":-121,"width":254,"height":185,"text":"Apply required Data Transformations. \n- Derive Hash keys of dimensions.\n- Parse Unix Timestamp into other formats","colour":"e6e63c"}},"noteConnectors":{},"variables":{"curr_ts":{"definition":{"name":"curr_ts","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"1900-01-01 00:00:00"},"max_audit_ts":{"definition":{"name":"max_audit_ts","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"0"}},"grids":{}},"info":{"name":"Matillion Audit Fact - Load","description":"","type":"TRANSFORMATION","tag":"7d6e25ac-bc6d-413d-b0d0-7d9832ec4f39"}}